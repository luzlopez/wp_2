!function(win){"use strict";function FastDom(){var self=this;self.reads=[],self.writes=[],self.raf=raf.bind(win),debug("initialized",self)}function scheduleFlush(fastdom){fastdom.scheduled||(fastdom.scheduled=!0,fastdom.raf(flush.bind(null,fastdom)),debug("flush scheduled"))}function flush(fastdom){debug("flush");var error,writes=fastdom.writes,reads=fastdom.reads;try{debug("flushing reads",reads.length),runTasks(reads),debug("flushing writes",writes.length),runTasks(writes)}catch(e){error=e}if(fastdom.scheduled=!1,(reads.length||writes.length)&&scheduleFlush(fastdom),error){if(debug("task errored",error.message),!fastdom.catch)throw error;fastdom.catch(error)}}function runTasks(tasks){debug("run tasks");for(var task;task=tasks.shift();)task()}function remove(array,item){var index=array.indexOf(item);return!!~index&&!!array.splice(index,1)}function mixin(target,source){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}var debug=function(){},raf=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(cb){return setTimeout(cb,16)};FastDom.prototype={constructor:FastDom,measure:function(fn,ctx){debug("measure");var task=ctx?fn.bind(ctx):fn;return this.reads.push(task),scheduleFlush(this),task},mutate:function(fn,ctx){debug("mutate");var task=ctx?fn.bind(ctx):fn;return this.writes.push(task),scheduleFlush(this),task},clear:function(task){return debug("clear",task),remove(this.reads,task)||remove(this.writes,task)},extend:function(props){if(debug("extend",props),"object"!=typeof props)throw new Error("expected object");var child=Object.create(this);return mixin(child,props),child.fastdom=this,child.initialize&&child.initialize(),child},catch:null};var exports=win.fastdom=win.fastdom||new FastDom;"f"==(typeof define)[0]?define(function(){return exports}):"o"==(typeof module)[0]&&(module.exports=exports)}("undefined"!=typeof window?window:this);